---
import Layout from '../layouts/Layout.astro';
import rumbleHistory from '../data/rumble-history.json';
import wrestlersData from '../data/wrestlers.json';
import VideoCarousel from '../components/VideoCarousel';

const wrestlers = wrestlersData.wrestlers;

// Helper to find wrestler image by name (handles partial matches)
function getWrestlerImage(name: string): string | null {
  const normalizedName = name.toLowerCase();
  const wrestler = wrestlers.find(w => {
    const wrestlerName = w.name.toLowerCase();
    return wrestlerName === normalizedName ||
           wrestlerName.includes(normalizedName) ||
           normalizedName.includes(wrestlerName);
  });
  return wrestler?.imageUrl || null;
}

// Records data with images - precompute URLs
const mensRecords = [
  { label: "Most Wins", value: "Stone Cold (3)", wrestler: "Stone Cold Steve Austin", image: getWrestlerImage("Stone Cold Steve Austin") },
  { label: "Most Appearances", value: "Kane (18)", wrestler: "Kane", image: getWrestlerImage("Kane") },
  { label: "Iron Man Record", value: "Gunther 1:11:25", wrestler: "Gunther", image: getWrestlerImage("Gunther") },
  { label: "Most Eliminations", value: "Lesnar/Strowman (13)", wrestler: "Brock Lesnar", image: getWrestlerImage("Brock Lesnar") },
  { label: "Career Eliminations", value: "Kane (45)", wrestler: "Kane", image: getWrestlerImage("Kane") },
  { label: "Fastest Win", value: "Lesnar 2:32", wrestler: "Brock Lesnar", image: getWrestlerImage("Brock Lesnar") },
  { label: "Shortest Time", value: "Santino 1 second", wrestler: "Santino Marella", image: getWrestlerImage("Santino Marella") },
];

const womensRecords = [
  { label: "Most Wins", value: "Charlotte (2)", wrestler: "Charlotte Flair", image: getWrestlerImage("Charlotte Flair") },
  { label: "Most Appearances", value: "Liv/Natalya (8)", wrestler: "Liv Morgan", image: getWrestlerImage("Liv Morgan") },
  { label: "Iron Woman Record", value: "Roxanne 1:07:47", wrestler: "Roxanne Perez", image: getWrestlerImage("Roxanne Perez") },
  { label: "Most Eliminations", value: "Nia Jax (9)", wrestler: "Nia Jax", image: getWrestlerImage("Nia Jax") },
  { label: "Career Eliminations", value: "Nia Jax (28)", wrestler: "Nia Jax", image: getWrestlerImage("Nia Jax") },
  { label: "Shortest Time", value: "Chelsea 4 seconds", wrestler: "Chelsea Green", image: getWrestlerImage("Chelsea Green") },
];

// Multi-time winners with images
const mensWinners = rumbleHistory.multiTimeWinners.men.map(w => ({
  ...w,
  image: getWrestlerImage(w.wrestler)
}));

const womensWinners = rumbleHistory.multiTimeWinners.women.map(w => ({
  ...w,
  image: getWrestlerImage(w.wrestler)
}));
---

<Layout title="Reference">
  <div class="space-y-8">
    <!-- Header -->
    <div class="text-center">
      <h1 class="text-4xl sm:text-5xl font-black mb-2 page-title">
        <span class="rumble-title">ROYAL RUMBLE</span>
        <span class="blue-chrome-text"> REFERENCE</span>
      </h1>
      <p class="text-purple-300 max-w-lg mx-auto">
        History, records, classic commercials, and tropes to get you hyped
      </p>
    </div>

    <!-- Video Carousel -->
    <section>
      <VideoCarousel client:load />
    </section>

    <!-- Lucky Numbers -->
    <section class="vaporwave-card p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span class="text-2xl">üçÄ</span>
        <span class="gold-chrome-text">LUCKY</span>
        <span class="text-white">ENTRY NUMBERS</span>
      </h2>
      <p class="text-purple-300 text-sm mb-4">
        These entry positions have produced the most Royal Rumble winners throughout history.
      </p>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Men's -->
        <div>
          <h3 class="blue-chrome-text font-bold mb-3 text-lg">Men's Rumble</h3>
          <div class="space-y-2">
            {Object.entries(rumbleHistory.luckyNumbers.men)
              .sort((a, b) => b[1].wins - a[1].wins)
              .map(([num, data]) => (
                <div class="flex items-center gap-3 p-2 bg-gray-800/50 rounded-lg border border-blue-900/50 hover:border-cyan-500/50 transition-colors">
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/20">
                    {num}
                  </div>
                  <div class="flex-1">
                    <div class="text-white font-medium">{data.wins} wins</div>
                    <div class="text-cyan-400/70 text-xs truncate" title={data.winners.join(', ')}>
                      {data.winners.slice(0, 2).join(', ')}{data.winners.length > 2 ? '...' : ''}
                    </div>
                  </div>
                </div>
              ))}
          </div>
        </div>

        <!-- Women's -->
        <div>
          <h3 class="pink-chrome-text font-bold mb-3 text-lg">Women's Rumble</h3>
          <div class="space-y-2">
            {Object.entries(rumbleHistory.luckyNumbers.women)
              .sort((a, b) => b[1].wins - a[1].wins)
              .map(([num, data]) => (
                <div class="flex items-center gap-3 p-2 bg-gray-800/50 rounded-lg border border-pink-900/50 hover:border-pink-500/50 transition-colors">
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-lg shadow-pink-500/20">
                    {num}
                  </div>
                  <div class="flex-1">
                    <div class="text-white font-medium">{data.wins} {data.wins === 1 ? 'win' : 'wins'}</div>
                    <div class="text-pink-400/70 text-xs truncate">
                      {data.winners.join(', ')}
                    </div>
                  </div>
                </div>
              ))}
          </div>
        </div>
      </div>

      <!-- Numbers that never won -->
      <div class="mt-4 p-3 bg-red-900/20 rounded-lg border border-red-600/30">
        <div class="text-sm">
          <strong class="text-red-400">Numbers that have NEVER won:</strong>{' '}
          <span class="text-gray-300">{rumbleHistory.luckyNumbers.neverWon.join(', ')}</span>
        </div>
      </div>
    </section>

    <!-- Records -->
    <section class="vaporwave-card p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span class="text-2xl">üèÜ</span>
        <span class="gold-chrome-text">ROYAL RUMBLE</span>
        <span class="text-white">RECORDS</span>
      </h2>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Men's Records -->
        <div class="bg-gradient-to-br from-blue-900/20 to-transparent p-4 rounded-lg border border-blue-800/30">
          <h3 class="blue-chrome-text font-bold mb-3 text-lg">Men's Records</h3>
          <div class="space-y-2">
            {mensRecords.map(record => (
              <div class="flex items-center gap-3 p-2 bg-gray-800/50 rounded border-l-2 border-cyan-500">
                <div class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden flex-shrink-0">
                  {record.image ? (
                    <img src={record.image} alt={record.wrestler} class="w-full h-full object-cover" />
                  ) : (
                    <div class="w-full h-full flex items-center justify-center text-gray-400 text-xs font-bold">
                      {record.wrestler.charAt(0)}
                    </div>
                  )}
                </div>
                <span class="text-cyan-300 text-sm flex-1">{record.label}</span>
                <span class="text-white text-sm font-bold">{record.value}</span>
              </div>
            ))}
          </div>
        </div>

        <!-- Women's Records -->
        <div class="bg-gradient-to-br from-pink-900/20 to-transparent p-4 rounded-lg border border-pink-800/30">
          <h3 class="pink-chrome-text font-bold mb-3 text-lg">Women's Records</h3>
          <div class="space-y-2">
            {womensRecords.map(record => (
              <div class="flex items-center gap-3 p-2 bg-gray-800/50 rounded border-l-2 border-pink-500">
                <div class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden flex-shrink-0">
                  {record.image ? (
                    <img src={record.image} alt={record.wrestler} class="w-full h-full object-cover" />
                  ) : (
                    <div class="w-full h-full flex items-center justify-center text-gray-400 text-xs font-bold">
                      {record.wrestler.charAt(0)}
                    </div>
                  )}
                </div>
                <span class="text-pink-300 text-sm flex-1">{record.label}</span>
                <span class="text-white text-sm font-bold">{record.value}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Multi-time Winners -->
    <section class="vaporwave-card p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span class="text-2xl">‚≠ê</span>
        <span class="gold-chrome-text">MULTI-TIME</span>
        <span class="text-white">WINNERS</span>
      </h2>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
        {mensWinners.map(winner => (
          <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-900/30 to-transparent rounded-lg border border-purple-500/30 hover:border-purple-400/60 transition-all hover:shadow-lg hover:shadow-purple-500/10">
            <div class="relative flex-shrink-0">
              <div class="w-12 h-12 rounded-full bg-gray-700 overflow-hidden">
                {winner.image ? (
                  <img src={winner.image} alt={winner.wrestler} class="w-full h-full object-cover" />
                ) : (
                  <div class="w-full h-full flex items-center justify-center text-gray-400 font-bold">
                    {winner.wrestler.charAt(0)}
                  </div>
                )}
              </div>
              <div class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-xs font-bold shadow-lg shadow-purple-500/30">
                {winner.wins}x
              </div>
            </div>
            <span class="text-white font-medium">{winner.wrestler}</span>
          </div>
        ))}
        {womensWinners.map(winner => (
          <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-pink-900/30 to-transparent rounded-lg border border-pink-500/30 hover:border-pink-400/60 transition-all hover:shadow-lg hover:shadow-pink-500/10">
            <div class="relative flex-shrink-0">
              <div class="w-12 h-12 rounded-full bg-gray-700 overflow-hidden">
                {winner.image ? (
                  <img src={winner.image} alt={winner.wrestler} class="w-full h-full object-cover" />
                ) : (
                  <div class="w-full h-full flex items-center justify-center text-gray-400 font-bold">
                    {winner.wrestler.charAt(0)}
                  </div>
                )}
              </div>
              <div class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white text-xs font-bold shadow-lg shadow-pink-500/30">
                {winner.wins}x
              </div>
            </div>
            <span class="text-white font-medium">{winner.wrestler}</span>
          </div>
        ))}
      </div>
    </section>

    <!-- Tropes -->
    <section class="vaporwave-card p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span class="text-2xl">üé≠</span>
        <span class="gold-chrome-text">ROYAL RUMBLE</span>
        <span class="text-white">TROPES</span>
      </h2>
      <p class="text-purple-300 text-sm mb-4">
        Common situations and moments to watch for during the match.
      </p>

      <div class="grid md:grid-cols-2 gap-4">
        {rumbleHistory.tropes.map(trope => (
          <div class="p-4 bg-gradient-to-br from-gray-800/80 to-gray-900/80 rounded-lg border border-purple-800/30 hover:border-purple-500/50 transition-all group">
            <h4 class="text-white font-bold mb-1 group-hover:text-cyan-400 transition-colors">{trope.name}</h4>
            <p class="text-gray-300 text-sm mb-2">{trope.description}</p>
            {trope.famousExamples && (
              <div class="text-xs text-cyan-400">
                Examples: {trope.famousExamples.slice(0, 2).join(', ')}
              </div>
            )}
            {trope.note && (
              <div class="text-xs text-yellow-400 mt-1 font-medium">{trope.note}</div>
            )}
          </div>
        ))}
      </div>
    </section>

    <!-- Rules -->
    <section class="vaporwave-card p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span class="text-2xl">üìã</span>
        <span class="gold-chrome-text">THE</span>
        <span class="text-white">RULES</span>
      </h2>

      <div class="prose prose-invert max-w-none">
        <ul class="space-y-3">
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">1.</span>
            <span>30 participants enter at timed intervals (90 seconds)</span>
          </li>
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">2.</span>
            <span>Entry order is determined by lottery before the match</span>
          </li>
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">3.</span>
            <span>Elimination occurs when a wrestler goes <strong class="text-red-400">over the top rope</strong> with <strong class="text-red-400">both feet</strong> touching the floor</span>
          </li>
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">4.</span>
            <span>Going under/through the ropes does <strong class="text-green-400">NOT</strong> count as elimination</span>
          </li>
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">5.</span>
            <span>The last wrestler remaining <strong class="gold-chrome-text">WINS</strong></span>
          </li>
          <li class="flex items-start gap-3 text-gray-200">
            <span class="text-cyan-400 font-bold">6.</span>
            <span>Winner receives a <strong class="text-purple-400">World Championship match at WrestleMania</strong></span>
          </li>
        </ul>
      </div>
    </section>
  </div>
</Layout>

<style>
  .record-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    background-color: rgba(31, 41, 55, 0.5);
    border-radius: 0.25rem;
  }
</style>
